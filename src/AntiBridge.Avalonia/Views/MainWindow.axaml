<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:AntiBridge.Avalonia.ViewModels"
        x:Class="AntiBridge.Avalonia.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="AntiBridge - Antigravity Account Manager"
        Width="500" Height="600"
        WindowStartupLocation="CenterScreen"
        Background="#1a1a2e">

    <Design.DataContext>
        <vm:MainViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto" Margin="20">
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="ðŸš€ AntiBridge" 
                       FontSize="28" FontWeight="Bold" 
                       Foreground="#00d9ff"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="Antigravity Account Manager" 
                       FontSize="14" 
                       Foreground="#888"
                       HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Main Content -->
        <Border Grid.Row="1" 
                Background="#16213e" 
                CornerRadius="12" 
                Padding="20">
            <Panel>
            <!-- Login View (when not logged in) -->
            <StackPanel IsVisible="{Binding !IsLoggedIn}" 
                        VerticalAlignment="Center"
                        Spacing="20">
                
                <TextBlock Text="Login with your Google account to view quota"
                           Foreground="#aaa"
                           HorizontalAlignment="Center"
                           TextWrapping="Wrap"/>
                
                <Button Command="{Binding LoginCommand}"
                        IsEnabled="{Binding !IsLoading}"
                        HorizontalAlignment="Center"
                        Padding="30,15"
                        Background="#4285f4"
                        Foreground="White"
                        FontWeight="SemiBold"
                        CornerRadius="8">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <TextBlock Text="ðŸ”" FontSize="18"/>
                        <TextBlock Text="Login with Google" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Import from Antigravity -->
                <Button Command="{Binding ImportFromAntigravityCommand}"
                        IsEnabled="{Binding !IsLoading}"
                        IsVisible="{Binding IsAntigravityInstalled}"
                        HorizontalAlignment="Center"
                        Padding="25,12"
                        Background="#0f3460"
                        Foreground="#00d9ff"
                        FontWeight="SemiBold"
                        CornerRadius="8">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="ðŸ“¥" FontSize="16"/>
                        <TextBlock Text="Import from Antigravity" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <!-- Loading indicator -->
                <ProgressBar IsIndeterminate="True" 
                             IsVisible="{Binding IsLoading}"
                             Height="4"
                             Margin="50,0"/>
            </StackPanel>

            <!-- Dashboard View (when logged in) -->
            <Grid IsVisible="{Binding IsLoggedIn}" RowDefinitions="Auto,*,Auto">
                
                <!-- Account Info -->
                <Border Grid.Row="0" 
                        Background="#0f3460" 
                        CornerRadius="8" 
                        Padding="15"
                        Margin="0,0,0,15">
                    <StackPanel Spacing="10">
                        <!-- Current Account -->
                        <Grid ColumnDefinitions="*,Auto">
                            <StackPanel>
                                <TextBlock Text="{Binding CurrentAccount.Name}" 
                                           FontSize="16" FontWeight="SemiBold"
                                           Foreground="White"/>
                                <TextBlock Text="{Binding CurrentAccount.Email}" 
                                           FontSize="12"
                                           Foreground="#888"/>
                            </StackPanel>
                            <Button Grid.Column="1" 
                                    Command="{Binding LogoutCommand}"
                                    Content="Logout"
                                    Background="#e94560"
                                    Foreground="White"
                                    Padding="15,8"
                                    CornerRadius="6"/>
                        </Grid>
                        
                        <!-- Account Switcher (when multiple accounts) -->
                        <Border IsVisible="{Binding HasMultipleAccounts}"
                                Background="#1a1a2e"
                                CornerRadius="6"
                                Padding="10">
                            <StackPanel Spacing="5">
                                <TextBlock Text="Switch Account:" 
                                           FontSize="11" 
                                           Foreground="#666"/>
                                <ComboBox ItemsSource="{Binding AllAccounts}"
                                          SelectedItem="{Binding CurrentAccount}"
                                          HorizontalAlignment="Stretch"
                                          Background="#16213e"
                                          Foreground="White">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Email}" Foreground="White"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>

                <!-- Model Quotas List -->
                <ScrollViewer Grid.Row="1">
                    <ItemsControl ItemsSource="{Binding ModelQuotas}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#0f3460" 
                                        CornerRadius="8" 
                                        Padding="15" 
                                        Margin="0,0,0,8">
                                    <Grid RowDefinitions="Auto,Auto,Auto">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <TextBlock Text="{Binding DisplayName}" 
                                                       FontWeight="SemiBold"
                                                       Foreground="White"/>
                                            <TextBlock Grid.Column="1" 
                                                       Text="{Binding PercentageText}"
                                                       FontWeight="Bold"
                                                       Foreground="{Binding ProgressColor}"/>
                                        </Grid>
                                        <Border Grid.Row="1" 
                                                Height="6" 
                                                CornerRadius="3"
                                                Background="#1a1a2e"
                                                Margin="0,8,0,0">
                                            <Border HorizontalAlignment="Left"
                                                    CornerRadius="3"
                                                    Background="{Binding ProgressColor}">
                                                <Border.Width>
                                                    <MultiBinding>
                                                        <Binding Path="Percentage"/>
                                                    </MultiBinding>
                                                </Border.Width>
                                            </Border>
                                        </Border>
                                        <!-- Reset Time -->
                                        <TextBlock Grid.Row="2" 
                                                   Text="{Binding ResetTimeDisplay}"
                                                   FontSize="11"
                                                   Foreground="#666"
                                                   Margin="0,6,0,0"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Action Buttons -->
                <StackPanel Grid.Row="2" Spacing="10" Margin="0,15,0,0">
                    <Button Command="{Binding RefreshQuotaCommand}"
                            IsEnabled="{Binding !IsLoading}"
                            HorizontalAlignment="Stretch"
                            Padding="15"
                            Background="#00d9ff"
                            Foreground="#1a1a2e"
                            FontWeight="SemiBold"
                            CornerRadius="8">
                        <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ”„" FontSize="16"/>
                            <TextBlock Text="Refresh Quota" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Sync to Antigravity -->
                    <Button Command="{Binding SyncToAntigravityCommand}"
                            IsEnabled="{Binding !IsLoading}"
                            IsVisible="{Binding IsAntigravityInstalled}"
                            HorizontalAlignment="Stretch"
                            Padding="12"
                            Background="#0f3460"
                            Foreground="#22c55e"
                            FontWeight="SemiBold"
                            CornerRadius="8">
                        <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ“¤" FontSize="14"/>
                            <TextBlock Text="Sync to Antigravity" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
            </Panel>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="2" 
                Background="#16213e" 
                CornerRadius="8" 
                Padding="15,10"
                Margin="0,15,0,0">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="{Binding StatusMessage}" 
                           Foreground="#888"
                           VerticalAlignment="Center"/>
                <TextBlock Grid.Column="1"
                           Text="{Binding ErrorMessage}" 
                           Foreground="#ef4444"
                           IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</Window>
